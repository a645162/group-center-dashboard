# 统计图表潜在需求文档

## 当前状态分析

### 已修复的图表

1. **GPU使用统计图表** - 饼图和柱状图 ✅
2. **项目统计图表** - 饼图和柱状图 ✅
3. **用户统计图表** - 饼图和柱状图 ✅
4. **时间趋势图表** - 线图和双轴图 ✅

### 主要修复内容

- 使用Ant Design Charts最新API格式
- 将`value`字段改为`field`字段
- 更新tooltip配置格式
- 添加动画效果和响应式配置
- 优化标签格式化和百分比计算

## 缺失的图表功能

### 1. 项目类型分布图

**当前状态**: 只有占位符，没有实际图表 **需求**:

- 显示不同项目类型的任务分布
- 支持按时间范围筛选
- 可能需要后端提供项目类型分类数据

### 2. 项目使用趋势图

**当前状态**: 只有占位符，没有实际图表 **需求**:

- 显示项目使用量的时间趋势
- 支持多项目对比
- 可能需要后端提供项目级别的使用统计

### 3. 任务数与GPU使用率对比图

**当前状态**: 只有占位符，没有实际图表 **需求**:

- 双轴图显示任务数和GPU使用率的关系
- 可能需要后端提供关联统计数据

### 4. 用户活动时间分布图

**当前状态**: 只有占位符，没有实际图表 **需求**:

- 显示用户在不同时间段的活跃度
- 热力图或时间分布图
- 可能需要后端提供用户活动时间数据

## 潜在的新图表需求

### 1. GPU资源利用率热力图

**用途**: 显示GPU服务器在不同时间段的使用情况 **数据需求**:

- 服务器ID、时间戳、利用率
- 支持按天/周/月查看
- 颜色编码表示利用率高低

### 2. 任务等待时间分析

**用途**: 分析任务排队和等待时间 **数据需求**:

- 任务提交时间、开始时间、等待时长
- 按项目/用户/优先级分类
- 趋势分析和异常检测

### 3. 成本效益分析图

**用途**: 分析GPU资源使用成本效益 **数据需求**:

- 资源使用时长、任务价值、成本计算
- 按项目/用户/时间段统计
- ROI分析和优化建议

### 4. 异常检测图表

**用途**: 检测异常使用模式和潜在问题 **数据需求**:

- 历史使用基线、当前使用模式
- 异常阈值设定
- 告警和建议

### 5. 预测分析图表

**用途**: 预测未来资源需求 **数据需求**:

- 历史使用趋势、季节性模式
- 增长预测算法
- 资源规划建议

## 后端API需求建议

### 新增API接口

1. `/api/dashboard/project-type-distribution`
   - 参数: timePeriod
   - 返回: 项目类型分布数据

2. `/api/dashboard/project-usage-trend`
   - 参数: timePeriod, projectIds(可选)
   - 返回: 项目使用趋势数据

3. `/api/dashboard/task-gpu-correlation`
   - 参数: timePeriod
   - 返回: 任务数与GPU使用率关联数据

4. `/api/dashboard/user-activity-distribution`
   - 参数: timePeriod, userId(可选)
   - 返回: 用户活动时间分布数据

5. `/api/dashboard/gpu-utilization-heatmap`
   - 参数: timeRange, serverIds(可选)
   - 返回: GPU利用率热力图数据

6. `/api/dashboard/task-waiting-analysis`
   - 参数: timePeriod, filters(可选)
   - 返回: 任务等待时间分析数据

7. `/api/dashboard/cost-benefit-analysis`
   - 参数: timePeriod, projectIds(可选)
   - 返回: 成本效益分析数据

8. `/api/dashboard/anomaly-detection`
   - 参数: timePeriod, sensitivity
   - 返回: 异常检测结果

9. `/api/dashboard/prediction-analysis`
   - 参数: predictionPeriod, historicalDataRange
   - 返回: 预测分析结果

### 现有API增强

1. **增强时间趋势API**
   - 添加更多维度的数据
   - 支持更细粒度的时间间隔
   - 添加同比环比计算

2. **增强用户统计API**
   - 添加用户活跃度时间分布
   - 添加用户行为模式分析
   - 添加用户效率指标

## 技术实现建议

### 前端图表库选择

- 继续使用Ant Design Charts，保持UI一致性
- 考虑使用ECharts作为补充，支持更复杂的图表类型
- 添加图表交互功能：缩放、筛选、导出

### 性能优化

- 实现图表数据缓存机制
- 支持图表懒加载
- 优化大数据量图表渲染性能

### 用户体验优化

- 添加图表加载动画
- 实现图表数据刷新机制
- 支持图表全屏查看
- 添加图表导出功能（PNG/SVG/CSV）

## 实施优先级建议

### 高优先级（立即实施）

1. 补充缺失的4个占位符图表
2. 增强现有API的数据维度
3. 修复时间趋势API的后端问题

### 中优先级（1-2周内）

1. GPU资源利用率热力图
2. 任务等待时间分析
3. 异常检测图表

### 低优先级（后续规划）

1. 成本效益分析
2. 预测分析图表
3. 高级交互功能

## 总结

当前统计页面的主要问题是Ant Design Charts API版本更新导致的配置不兼容，已通过更新图表配置解决。缺失的图表功能需要后端提供相应的数据接口支持。建议按照优先级逐步实施，先补充基础功能，再添加高级分析功能。
